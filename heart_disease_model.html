import React, { useState } from 'react';
import { Heart, AlertCircle, CheckCircle, Info, Activity } from 'lucide-react';

export default function CardioCanada() {
  const [language, setLanguage] = useState('en');
  const [formData, setFormData] = useState({
    age: '',
    sex: '',
    chestPain: '',
    restingBP: '',
    cholesterol: '',
    fastingBS: '',
    restingECG: '',
    maxHR: '',
    exerciseAngina: '',
    oldpeak: '',
    stSlope: ''
  });

  const [result, setResult] = useState(null);
  const [errors, setErrors] = useState({});

  const translations = {
    en: {
      title: "CardioRural",
      subtitle: "Cardiovascular Risk Assessment Tool",
      developer: "Developed by MENCHA",
      infoText: "This tool provides preliminary cardiovascular risk screening based on clinical parameters. It is designed for Canadian healthcare settings and follows Health Canada guidelines.",
      patientInfo: "Patient Information",
      age: "Age (years)",
      sex: "Sex",
      male: "Male",
      female: "Female",
      chestPain: "Chest Pain Type",
      typicalAngina: "Typical Angina",
      atypicalAngina: "Atypical Angina",
      nonAnginal: "Non-Anginal Pain",
      asymptomatic: "Asymptomatic",
      restingBP: "Resting Blood Pressure (mmHg)",
      cholesterol: "Cholesterol (mg/dL)",
      fastingBS: "Fasting Blood Sugar > 120 mg/dL",
      yes: "Yes",
      no: "No",
      restingECG: "Resting ECG Result",
      normal: "Normal",
      stWave: "ST-T Wave Abnormality",
      lvh: "Left Ventricular Hypertrophy",
      maxHR: "Maximum Heart Rate (bpm)",
      exerciseAngina: "Exercise-Induced Angina",
      stDepression: "ST Depression (Oldpeak)",
      stSlope: "ST Slope",
      upsloping: "Upsloping",
      flat: "Flat",
      downsloping: "Downsloping",
      calculate: "Calculate Risk Assessment",
      select: "Select...",
      highRisk: "High Risk",
      moderateRisk: "Moderate Risk",
      lowRisk: "Low Risk",
      riskScore: "Risk Score",
      recommendations: "Recommended Actions:",
      provincialResources: "Provincial Resources:",
      resourcesText: "Ontario: Telehealth Ontario (1-866-797-0000) • Alberta: Health Link (811) • BC: HealthLink BC (811) • Quebec: Info-Santé (811)",
      disclaimer: "Medical Disclaimer:",
      disclaimerText: "This tool provides preliminary cardiovascular risk screening for educational purposes only. It is NOT a substitute for professional medical diagnosis, treatment, or clinical judgment. Always consult with a qualified healthcare provider for proper medical evaluation. In case of emergency (chest pain, difficulty breathing), call 911 immediately.",
      footer: "Built for Canadian healthcare settings • Following Health Canada guidelines",
      license: "Open source • MIT License",
      highRiskRecs: [
        "Seek immediate medical consultation with a cardiologist",
        "Consider comprehensive cardiac evaluation including stress test",
        "Discuss medication options with your healthcare provider",
        "Monitor blood pressure and heart rate daily",
        "Adopt heart-healthy diet (Mediterranean or DASH diet)",
        "Engage in supervised cardiac rehabilitation if recommended"
      ],
      moderateRiskRecs: [
        "Schedule appointment with family physician for cardiovascular assessment",
        "Have cholesterol and blood sugar checked regularly",
        "Start moderate physical activity (150 min/week as per Health Canada)",
        "Reduce sodium intake to less than 2,300 mg/day",
        "Maintain healthy weight (BMI 18.5-24.9)",
        "Consider stress management techniques",
        "Quit smoking if applicable"
      ],
      lowRiskRecs: [
        "Continue regular health checkups",
        "Maintain active lifestyle with regular exercise",
        "Follow Canada's Food Guide for healthy eating",
        "Keep blood pressure under 130/80 mmHg",
        "Monitor cholesterol levels annually",
        "Stay tobacco-free and limit alcohol consumption"
      ],
      errors: {
        age: "Age must be between 18 and 120",
        restingBP: "BP must be between 80 and 200 mmHg",
        cholesterol: "Cholesterol must be between 100 and 600 mg/dL",
        maxHR: "Heart rate must be between 60 and 220 bpm",
        oldpeak: "ST depression must be between 0 and 10"
      }
    },
    fr: {
      title: "CardioCanada",
      subtitle: "Outil d'évaluation du risque cardiovasculaire",
      infoText: "Cet outil fournit un dépistage préliminaire du risque cardiovasculaire basé sur des paramètres cliniques. Il est conçu pour les établissements de santé canadiens et suit les directives de Santé Canada.",
      patientInfo: "Informations sur le patient",
      age: "Âge (années)",
      sex: "Sexe",
      male: "Homme",
      female: "Femme",
      chestPain: "Type de douleur thoracique",
      typicalAngina: "Angine typique",
      atypicalAngina: "Angine atypique",
      nonAnginal: "Douleur non angineuse",
      asymptomatic: "Asymptomatique",
      restingBP: "Tension artérielle au repos (mmHg)",
      cholesterol: "Cholestérol (mg/dL)",
      fastingBS: "Glycémie à jeun > 120 mg/dL",
      yes: "Oui",
      no: "Non",
      restingECG: "Résultat ECG au repos",
      normal: "Normal",
      stWave: "Anomalie de l'onde ST-T",
      lvh: "Hypertrophie ventriculaire gauche",
      maxHR: "Fréquence cardiaque maximale (bpm)",
      exerciseAngina: "Angine induite par l'exercice",
      stDepression: "Dépression ST (Oldpeak)",
      stSlope: "Pente ST",
      upsloping: "Ascendante",
      flat: "Plate",
      downsloping: "Descendante",
      calculate: "Calculer l'évaluation du risque",
      select: "Sélectionner...",
      highRisk: "Risque élevé",
      moderateRisk: "Risque modéré",
      lowRisk: "Risque faible",
      riskScore: "Score de risque",
      recommendations: "Actions recommandées :",
      provincialResources: "Ressources provinciales :",
      resourcesText: "Ontario : Télésanté Ontario (1-866-797-0000) • Alberta : Health Link (811) • C.-B. : HealthLink BC (811) • Québec : Info-Santé (811)",
      disclaimer: "Avertissement médical :",
      disclaimerText: "Cet outil fournit un dépistage préliminaire du risque cardiovasculaire à des fins éducatives uniquement. Il ne remplace PAS un diagnostic médical professionnel, un traitement ou un jugement clinique. Consultez toujours un professionnel de la santé qualifié pour une évaluation médicale appropriée. En cas d'urgence (douleur thoracique, difficulté à respirer), composez le 911 immédiatement.",
      footer: "Conçu pour les établissements de santé canadiens • Conformément aux directives de Santé Canada",
      license: "Code source ouvert • Licence MIT",
      highRiskRecs: [
        "Consultez immédiatement un cardiologue",
        "Envisagez une évaluation cardiaque complète incluant un test d'effort",
        "Discutez des options de médication avec votre professionnel de santé",
        "Surveillez votre tension artérielle et fréquence cardiaque quotidiennement",
        "Adoptez une alimentation saine pour le cœur (diète méditerranéenne ou DASH)",
        "Participez à une réadaptation cardiaque supervisée si recommandé"
      ],
      moderateRiskRecs: [
        "Prenez rendez-vous avec votre médecin de famille pour évaluation cardiovasculaire",
        "Faites vérifier régulièrement votre cholestérol et glycémie",
        "Commencez une activité physique modérée (150 min/semaine selon Santé Canada)",
        "Réduisez l'apport en sodium à moins de 2 300 mg/jour",
        "Maintenez un poids santé (IMC 18,5-24,9)",
        "Envisagez des techniques de gestion du stress",
        "Arrêtez de fumer si applicable"
      ],
      lowRiskRecs: [
        "Continuez les bilans de santé réguliers",
        "Maintenez un mode de vie actif avec exercice régulier",
        "Suivez le Guide alimentaire canadien pour une alimentation saine",
        "Gardez la tension artérielle sous 130/80 mmHg",
        "Surveillez les niveaux de cholestérol annuellement",
        "Restez sans tabac et limitez la consommation d'alcool"
      ],
      errors: {
        age: "L'âge doit être entre 18 et 120",
        restingBP: "La tension artérielle doit être entre 80 et 200 mmHg",
        cholesterol: "Le cholestérol doit être entre 100 et 600 mg/dL",
        maxHR: "La fréquence cardiaque doit être entre 60 et 220 bpm",
        oldpeak: "La dépression ST doit être entre 0 et 10"
      }
    }
  };

  const t = translations[language];

  const validateForm = () => {
    const newErrors = {};
    
    if (!formData.age || formData.age < 18 || formData.age > 120) {
      newErrors.age = t.errors.age;
    }
    if (!formData.restingBP || formData.restingBP < 80 || formData.restingBP > 200) {
      newErrors.restingBP = t.errors.restingBP;
    }
    if (!formData.cholesterol || formData.cholesterol < 100 || formData.cholesterol > 600) {
      newErrors.cholesterol = t.errors.cholesterol;
    }
    if (!formData.maxHR || formData.maxHR < 60 || formData.maxHR > 220) {
      newErrors.maxHR = t.errors.maxHR;
    }
    if (!formData.oldpeak || formData.oldpeak < 0 || formData.oldpeak > 10) {
      newErrors.oldpeak = t.errors.oldpeak;
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const calculateRisk = () => {
    if (!validateForm()) return;

    // Simple risk scoring algorithm (placeholder for ML model)
    let riskScore = 0;
    
    // Age factor
    if (formData.age > 65) riskScore += 3;
    else if (formData.age > 55) riskScore += 2;
    else if (formData.age > 45) riskScore += 1;

    // Sex factor
    if (formData.sex === 'M') riskScore += 1;

    // Chest pain
    if (formData.chestPain === 'ASY') riskScore += 3;
    else if (formData.chestPain === 'ATA') riskScore += 2;
    else if (formData.chestPain === 'NAP') riskScore += 1;

    // Blood pressure
    if (formData.restingBP > 140) riskScore += 2;
    else if (formData.restingBP > 130) riskScore += 1;

    // Cholesterol
    if (formData.cholesterol > 240) riskScore += 2;
    else if (formData.cholesterol > 200) riskScore += 1;

    // Fasting blood sugar
    if (formData.fastingBS === '1') riskScore += 1;

    // ECG
    if (formData.restingECG === 'ST' || formData.restingECG === 'LVH') riskScore += 2;

    // Max heart rate
    if (formData.maxHR < 100) riskScore += 2;
    else if (formData.maxHR < 120) riskScore += 1;

    // Exercise angina
    if (formData.exerciseAngina === 'Y') riskScore += 2;

    // ST depression
    if (formData.oldpeak > 2) riskScore += 3;
    else if (formData.oldpeak > 1) riskScore += 2;
    else if (formData.oldpeak > 0) riskScore += 1;

    // ST slope
    if (formData.stSlope === 'Down') riskScore += 2;
    else if (formData.stSlope === 'Flat') riskScore += 1;

    // Determine risk level
    let riskLevel, riskColor, recommendations;
    
    if (riskScore >= 15) {
      riskLevel = t.highRisk;
      riskColor = 'bg-red-100 border-red-500 text-red-900';
      recommendations = t.highRiskRecs;
    } else if (riskScore >= 8) {
      riskLevel = t.moderateRisk;
      riskColor = 'bg-yellow-100 border-yellow-500 text-yellow-900';
      recommendations = t.moderateRiskRecs;
    } else {
      riskLevel = t.lowRisk;
      riskColor = 'bg-green-100 border-green-500 text-green-900';
      recommendations = t.lowRiskRecs;
    }

    setResult({
      riskLevel,
      riskColor,
      riskScore,
      recommendations
    });
  };

  const handleInputChange = (field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));
    if (errors[field]) {
      setErrors(prev => ({ ...prev, [field]: '' }));
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-red-50 via-white to-blue-50 p-4">
      <div className="max-w-4xl mx-auto">
        {/* Language Toggle */}
        <div className="flex justify-end mb-4">
          <div className="bg-white rounded-lg shadow-md p-2 flex gap-2">
            <button
              onClick={() => setLanguage('en')}
              className={`px-4 py-2 rounded-md font-medium transition-colors ${
                language === 'en'
                  ? 'bg-red-600 text-white'
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              English
            </button>
            <button
              onClick={() => setLanguage('fr')}
              className={`px-4 py-2 rounded-md font-medium transition-colors ${
                language === 'fr'
                  ? 'bg-red-600 text-white'
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              Français
            </button>
          </div>
        </div>

        {/* Header */}
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6 border-l-4 border-red-600">
          <div className="flex items-center gap-3 mb-2">
            <Heart className="w-10 h-10 text-red-600" />
            <div>
              <h1 className="text-3xl font-bold text-gray-800">{t.title}</h1>
              <p className="text-gray-600">{t.subtitle}</p>
            </div>
          </div>
          <div className="mt-4 p-3 bg-blue-50 rounded-lg flex items-start gap-2">
            <Info className="w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0" />
            <p className="text-sm text-blue-900">
              {t.infoText}
            </p>
          </div>
        </div>

        {/* Main Form */}
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
            <Activity className="w-6 h-6 text-red-600" />
            {t.patientInfo}
          </h2>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {/* Age */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                {t.age} *
              </label>
              <input
                type="number"
                value={formData.age}
                onChange={(e) => handleInputChange('age', e.target.value)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                placeholder="e.g., 45"
              />
              {errors.age && <p className="text-red-600 text-xs mt-1">{errors.age}</p>}
            </div>

            {/* Sex */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                {t.sex} *
              </label>
              <select
                value={formData.sex}
                onChange={(e) => handleInputChange('sex', e.target.value)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
              >
                <option value="">{t.select}</option>
                <option value="M">{t.male}</option>
                <option value="F">{t.female}</option>
              </select>
            </div>

            {/* Chest Pain Type */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                {t.chestPain} *
              </label>
              <select
                value={formData.chestPain}
                onChange={(e) => handleInputChange('chestPain', e.target.value)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
              >
                <option value="">{t.select}</option>
                <option value="TA">{t.typicalAngina}</option>
                <option value="ATA">{t.atypicalAngina}</option>
                <option value="NAP">{t.nonAnginal}</option>
                <option value="ASY">{t.asymptomatic}</option>
              </select>
            </div>

            {/* Resting BP */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                {t.restingBP} *
              </label>
              <input
                type="number"
                value={formData.restingBP}
                onChange={(e) => handleInputChange('restingBP', e.target.value)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                placeholder="e.g., 120"
              />
              {errors.restingBP && <p className="text-red-600 text-xs mt-1">{errors.restingBP}</p>}
            </div>

            {/* Cholesterol */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                {t.cholesterol} *
              </label>
              <input
                type="number"
                value={formData.cholesterol}
                onChange={(e) => handleInputChange('cholesterol', e.target.value)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                placeholder="e.g., 200"
              />
              {errors.cholesterol && <p className="text-red-600 text-xs mt-1">{errors.cholesterol}</p>}
            </div>

            {/* Fasting Blood Sugar */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                {t.fastingBS} *
              </label>
              <select
                value={formData.fastingBS}
                onChange={(e) => handleInputChange('fastingBS', e.target.value)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
              >
                <option value="">{t.select}</option>
                <option value="0">{t.no}</option>
                <option value="1">{t.yes}</option>
              </select>
            </div>

            {/* Resting ECG */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                {t.restingECG} *
              </label>
              <select
                value={formData.restingECG}
                onChange={(e) => handleInputChange('restingECG', e.target.value)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
              >
                <option value="">{t.select}</option>
                <option value="Normal">{t.normal}</option>
                <option value="ST">{t.stWave}</option>
                <option value="LVH">{t.lvh}</option>
              </select>
            </div>

            {/* Max Heart Rate */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                {t.maxHR} *
              </label>
              <input
                type="number"
                value={formData.maxHR}
                onChange={(e) => handleInputChange('maxHR', e.target.value)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                placeholder="e.g., 150"
              />
              {errors.maxHR && <p className="text-red-600 text-xs mt-1">{errors.maxHR}</p>}
            </div>

            {/* Exercise Angina */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                {t.exerciseAngina} *
              </label>
              <select
                value={formData.exerciseAngina}
                onChange={(e) => handleInputChange('exerciseAngina', e.target.value)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
              >
                <option value="">{t.select}</option>
                <option value="N">{t.no}</option>
                <option value="Y">{t.yes}</option>
              </select>
            </div>

            {/* Oldpeak */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                {t.stDepression} *
              </label>
              <input
                type="number"
                step="0.1"
                value={formData.oldpeak}
                onChange={(e) => handleInputChange('oldpeak', e.target.value)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                placeholder="e.g., 1.5"
              />
              {errors.oldpeak && <p className="text-red-600 text-xs mt-1">{errors.oldpeak}</p>}
            </div>

            {/* ST Slope */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">
                {t.stSlope} *
              </label>
              <select
                value={formData.stSlope}
                onChange={(e) => handleInputChange('stSlope', e.target.value)}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
              >
                <option value="">{t.select}</option>
                <option value="Up">{t.upsloping}</option>
                <option value="Flat">{t.flat}</option>
                <option value="Down">{t.downsloping}</option>
              </select>
            </div>
          </div>

          <button
            onClick={calculateRisk}
            className="w-full mt-6 bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2"
          >
            <Heart className="w-5 h-5" />
            {t.calculate}
          </button>
        </div>

        {/* Results */}
        {result && (
          <div className={`rounded-lg shadow-lg p-6 border-l-4 ${result.riskColor}`}>
            <div className="flex items-center gap-3 mb-4">
              {result.riskLevel === t.highRisk && <AlertCircle className="w-8 h-8" />}
              {result.riskLevel === t.moderateRisk && <Info className="w-8 h-8" />}
              {result.riskLevel === t.lowRisk && <CheckCircle className="w-8 h-8" />}
              <div>
                <h3 className="text-2xl font-bold">{result.riskLevel}</h3>
                <p className="text-sm opacity-80">{t.riskScore}: {result.riskScore}/20+</p>
              </div>
            </div>

            <div className="mt-4">
              <h4 className="font-semibold mb-2">{t.recommendations}</h4>
              <ul className="space-y-2">
                {result.recommendations.map((rec, idx) => (
                  <li key={idx} className="flex items-start gap-2">
                    <span className="text-lg">•</span>
                    <span className="text-sm">{rec}</span>
                  </li>
                ))}
              </ul>
            </div>

            <div className="mt-6 p-4 bg-white bg-opacity-50 rounded-lg">
              <p className="text-sm font-medium">
                <strong>{t.provincialResources}</strong>
              </p>
              <p className="text-xs mt-2">
                {t.resourcesText}
              </p>
            </div>
          </div>
        )}

        {/* Disclaimer */}
        <div className="mt-6 bg-gray-100 rounded-lg p-4">
          <p className="text-xs text-gray-700">
            <strong> {t.disclaimer}</strong> {t.disclaimerText}
          </p>
        </div>

        {/* Footer */}
        <div className="mt-6 text-center text-sm text-gray-600">
          <p>{t.footer}</p>
          <p className="mt-2">{t.license}</p>
        </div>
      </div>
    </div>
  );
}
